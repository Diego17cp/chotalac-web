---
import { NAV_ITEMS } from "@/constants";
import { Icon } from 'astro-icon/components';
---
<div id="mobileMenuOverlay" class="fixed inset-0 bg-black/50 z-40 opacity-0 pointer-events-none transition-opacity duration-300 md:hidden"></div>
<div id="mobileMenuDrawer" class="fixed top-0 right-0 h-full w-80 max-w-full bg-white shadow-xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out md:hidden">
    <div class="flex items-center justify-between p-4 border-b border-gray-200">
        <img src="/chotalac-logo.webp" alt="Chotalac" class="h-12 w-auto" />
        <button
            id="mobileMenuClose"
            class="p-2 hover:bg-gray-100 text-gray-600 rounded-full transition-colors"
            aria-label="Cerrar menú"
        >
            <Icon name="x-mark" size={25} />
        </button>
    </div>
    <div class="p-4 border-b border-gray-200">
        <div class="relative">
            <input
                type="search"
                placeholder="Buscar productos..."
                class="w-full pl-4 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none transition-all duration-300 ease-in-out"
            />
            <button class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-600">
                <Icon name="magnifying-glass" size={20} />
            </button>
        </div>
    </div>
    <nav class="flex flex-col p-4 space-y-2 border-b border-gray-200">
        {NAV_ITEMS.map((item) => (
            <a
                href={item.href}
                class="mobile-nav-link px-4 py-3 text-gray-700 hover:bg-primary-light hover:text-primary rounded-lg transition-all duration-300 ease-in-out font-medium"
            >
                {item.label}
            </a>
        ))}
    </nav>
    <div class="flex flex-col p-4 space-y-2">
        <a
            href="/cuenta"
            class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
        >
            <Icon name="user-outline" size={24} />
            <span class="font-medium">Mi cuenta</span>
        </a>
        <button
            class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors text-left w-full"
        >
            <Icon name="cart-outline" size={24} />
            <span class="font-medium">Carrito</span>
            <span class="ml-auto bg-primary text-white text-xs rounded-full w-6 h-6 flex items-center justify-center">
                0
            </span>
        </button>
    </div>
    <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-gray-50">
        <p class="text-sm text-gray-600 text-center">
            © 2025 Chotalac. Todos los derechos reservados.
        </p>
    </div>
</div>

<script>
    function initMobileDrawer() {
        const mobileMenuToggle = document.getElementById("mobileMenuToggle");
        const mobileMenuClose = document.getElementById("mobileMenuClose");
        const mobileMenuOverlay = document.getElementById("mobileMenuOverlay");
        const mobileMenuDrawer = document.getElementById("mobileMenuDrawer");
        const mobileNavLinks = document.querySelectorAll(".mobile-nav-link");

        const openMobileMenu = () => {
            mobileMenuDrawer?.classList.remove("translate-x-full");
            mobileMenuOverlay?.classList.remove("opacity-0", "pointer-events-none");
            document.body.style.overflow = "hidden";
        };

        const closeMobileMenu = () => {
            mobileMenuDrawer?.classList.add("translate-x-full");
            mobileMenuOverlay?.classList.add("opacity-0", "pointer-events-none");
            document.body.style.overflow = "";
        };

        mobileMenuToggle?.addEventListener("click", openMobileMenu);
        mobileMenuClose?.addEventListener("click", closeMobileMenu);
        mobileMenuOverlay?.addEventListener("click", closeMobileMenu);

        mobileNavLinks.forEach(link => link.addEventListener("click", closeMobileMenu));

        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") closeMobileMenu();
        });
    }

    document.addEventListener("DOMContentLoaded", initMobileDrawer);
    document.addEventListener("astro:page-load", initMobileDrawer);
</script>